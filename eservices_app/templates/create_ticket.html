{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header">
            <h4 class="mb-0">
                Request for {{ selected_service or 'Service Ticket' }}
            </h4>
            <small class="text-muted">Department: {{ department_name or 'Select Department' }}</small>
        </div>
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data">
                {{ form.hidden_tag() }}

                <!-- Your Information -->
                <div class="card mb-3 border-0">
                    <div class="card-header bg-light">
                        <i class="bi bi-person-fill"></i> Your Information
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-3">
                            {{ form.full_name.label(class="form-label") }}
                            {{ form.full_name(class="form-control") }}
                            {% for error in form.full_name.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        </div>

                        <div class="form-group mb-3">
                            {{ form.deped_email.label(class="form-label") }}
                            {{ form.deped_email(class="form-control") }}
                            {% for error in form.deped_email.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        </div>

                        <div class="form-group mb-3">
                            {{ form.contact_number.label(class="form-label") }}
                            {{ form.contact_number(class="form-control") }}
                            {% for error in form.contact_number.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        </div>

                        <div class="form-group mb-3">
                            {{ form.school_office.label(class="form-label") }}
                            {{ form.school_office(class="form-select") }}
                            {% for error in form.school_office.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Request Details -->
                <div class="card border-0">
                    <div class="card-header bg-light">
                        <i class="bi bi-file-earmark-text"></i> Request Details
                    </div>
                    <div class="card-body">

                        <!-- ICT-related Sections -->
                        <div id="issuances" class="dynamic-section hidden"></div>
                        <div id="repair" class="dynamic-section hidden"></div>
                        <div id="deped_email" class="dynamic-section hidden"></div>
                        <div id="shared_fields" class="dynamic-section hidden"></div>

                        <!-- PERSONNEL SERVICES -->
                        <div id="personnel" class="dynamic-section hidden">
                            <div class="form-group mb-3">
                                {{ form.position.label(class="form-label") }}
                                {{ form.position(class="form-control") }}
                                {% for error in form.position.errors %}
                                    <small class="text-danger">{{ error }}</small>
                                {% endfor %}
                            </div>

                            <div class="form-group mb-3">
                                {{ form.bp_number.label(class="form-label") }}
                                {{ form.bp_number(class="form-control") }}
                                {% for error in form.bp_number.errors %}
                                    <small class="text-danger">{{ error }}</small>
                                {% endfor %}
                            </div>

                            <div class="form-group mb-3">
                                {{ form.purpose.label(class="form-label") }}
                                {{ form.purpose(class="form-control") }}
                                {% for error in form.purpose.errors %}
                                    <small class="text-danger">{{ error }}</small>
                                {% endfor %}
                            </div>

                            <div class="form-group mb-3">
                                {{ form.attachment.label(class="form-label") }}
                                {{ form.attachment(class="form-control") }}
                                {% for error in form.attachment.errors %}
                                    <small class="text-danger">{{ error }}</small>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- LEGAL SERVICES -->
                        <div id="no_pending_case" class="dynamic-section hidden">
                            <div class="form-group mb-3">
                                {{ form.position.label(class="form-label") }}
                                {{ form.position(class="form-control") }}
                                {% for error in form.position.errors %}
                                    <small class="text-danger">{{ error }}</small>
                                {% endfor %}
                            </div>

                            <div class="form-group mb-3">
                                {{ form.purpose.label(class="form-label") }}
                                {{ form.purpose(class="form-control", rows="3") }}
                                {% for error in form.purpose.errors %}
                                    <small class="text-danger">{{ error }}</small>
                                {% endfor %}
                            </div>

                            <div class="form-group mb-3">
                                {{ form.attachment.label(class="form-label") }}
                                {{ form.attachment(class="form-control") }}
                                {% for error in form.attachment.errors %}
                                    <small class="text-danger">{{ error }}</small>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-4 text-end">
                    <a href="{{ url_for('main.home') }}" class="btn btn-outline-secondary">
                        ‚Üê Back
                    </a>
                    <button type="submit" class="btn btn-primary">
                        Submit Ticket
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- Dynamic Section Handling -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const sections = {
        'Issuances and Online Materials': document.getElementById('issuances'),
        'Repair, Maintenance and Troubleshoot of IT Equipment': document.getElementById('repair'),
        'DepEd Email Account': document.getElementById('deped_email'),
        'DPDS - DepEd Partnership Database System': document.getElementById('shared_fields'),
        'DCP - DepEd Computerization Program: After-sales': document.getElementById('shared_fields'),
        'other ICT - Technical Assistance Needed': document.getElementById('shared_fields'),
        'Personnel Services': document.getElementById('personnel'),
        'Certificate of NO-Pending Case': document.getElementById('no_pending_case')
    };

    const serviceTypeSelect = document.getElementById('serviceTypeSelect');
    if (serviceTypeSelect) {
        serviceTypeSelect.addEventListener('change', function() {
            Object.values(sections).forEach(section => section.classList.add('hidden'));
            const selected = this.value;
            if (sections[selected]) {
                sections[selected].classList.remove('hidden');
            }
        });
    }
});
</script>

<style>
.hidden {
    display: none;
}
.card {
    border-radius: 12px;
}
.card-header {
    font-weight: 600;
}
.btn {
    border-radius: 8px;
}
</style>
{% endblock %}
